import{u as Y}from"./chunk-M3VFKDXJ-Cfhvqd45.js";import{u as re}from"./chunk-PFKKVLZX-DzM2ADPA.js";import{b as z,ao as ee,r as d,j as e,aF as L,c0 as te,B as oe,c1 as A,aI as J,$ as O,c2 as se,c3 as ce,c4 as ue,c5 as de,aK as U,U as B,I as K,c6 as W,_ as $,c7 as Q,c8 as R,X as ae,c9 as me,aG as pe,ca as he}from"./index-DWDHrirZ.js";var ne=d.createContext(null),H=()=>{const t=d.useContext(ne);if(!t)throw new Error("useDataTableFacetedFilterContext must be used within a DataTableFacetedFilter");return t},ge=({hadPreviousValue:t,label:l,value:s,readonly:x,hasOperator:r,onRemove:h})=>{const{t:b}=z(),c=f=>{f.stopPropagation(),h()};return e.jsxs("div",{className:"bg-ui-bg-field transition-fg shadow-borders-base text-ui-fg-subtle flex cursor-default select-none items-stretch overflow-hidden rounded-md",children:[!t&&e.jsx(pe,{}),e.jsx("div",{className:O("flex items-center justify-center whitespace-nowrap px-2 py-1",{"border-r":!!(s||t)}),children:e.jsx($,{size:"small",weight:"plus",leading:"compact",children:l})}),e.jsxs("div",{className:"flex w-full items-center overflow-hidden",children:[r&&!!(s||t)&&e.jsx("div",{className:"border-r p-1 px-2",children:e.jsx($,{size:"small",weight:"plus",leading:"compact",className:"text-ui-fg-muted",children:b("general.is")})}),!!(s||t)&&e.jsx(te,{asChild:!0,className:O("flex-1 cursor-pointer overflow-hidden border-r p-1 px-2",{"hover:bg-ui-bg-field-hover":!x,"data-[state=open]:bg-ui-bg-field-hover":!x}),children:e.jsx($,{size:"small",leading:"compact",weight:"plus",className:"truncate text-nowrap",children:s||"Â "})})]}),!x&&!!(s||t)&&e.jsx("button",{onClick:c,className:O("text-ui-fg-muted transition-fg flex items-center justify-center p-1","hover:bg-ui-bg-subtle-hover","active:bg-ui-bg-subtle-pressed active:text-ui-fg-base"),children:e.jsx(ae,{})})]})},G=ge,xe=({filter:t,prefix:l,readonly:s,openOnMount:x})=>{const[r,h]=d.useState(x),[b,c]=d.useState(!1),{getFullDate:f}=re(),{key:j,label:i}=t,{removeFilter:g}=H(),N=Y({param:j,prefix:l}),w=be(),a=n=>{N.add(JSON.stringify(n)),c(!1)},m=()=>{N.delete(),c(n=>!n)},y=N.get(),u=fe(y),v=Z(u,"$gte"),C=Z(u,"$lte"),k=(n,F)=>{const E=F==="start"?"$gte":"$lte",ie=n?n.toISOString():void 0;N.add(JSON.stringify({...u||{},[E]:ie}))},_=()=>{const n=w.find(F=>he(F.value,u));return n==null?void 0:n.label},P=n=>n?f({date:n}):void 0,T=()=>[v,C].map(P).filter(Boolean).join(" - "),V=_()||T(),[M,p]=d.useState(V),D=()=>{N.delete(),g(j)};let S=null;const o=n=>{h(n),p(V),S&&clearTimeout(S),!n&&!y.length&&(S=setTimeout(()=>{g(j)},200))};return e.jsxs(L,{modal:!0,open:r,onOpenChange:o,children:[e.jsx(G,{hadPreviousValue:!!M,label:i,value:V,onRemove:D,readonly:s}),!s&&e.jsx(A,{children:e.jsxs(J,{"data-name":"date_filter_content",align:"start",sideOffset:8,collisionPadding:24,className:O("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout h-full max-h-[var(--radix-popper-available-height)] w-[300px] overflow-auto rounded-lg"),onInteractOutside:n=>{var F;n.target instanceof HTMLElement&&((F=n.target.attributes.getNamedItem("data-name"))==null?void 0:F.value)==="filters_menu_content"&&n.preventDefault()},children:[e.jsxs("ul",{className:"w-full p-1",children:[w.map(n=>{const F=N.get().includes(JSON.stringify(n.value));return e.jsx("li",{children:e.jsxs("button",{className:"bg-ui-bg-base hover:bg-ui-bg-base-hover focus-visible:bg-ui-bg-base-pressed text-ui-fg-base data-[disabled]:text-ui-fg-disabled txt-compact-small relative flex w-full cursor-pointer select-none items-center rounded-md px-2 py-1.5 outline-none transition-colors data-[disabled]:pointer-events-none",type:"button",onClick:()=>{a(n.value)},children:[e.jsx("div",{className:O("transition-fg flex h-5 w-5 items-center justify-center",{"[&_svg]:invisible":!F}),children:e.jsx(U,{})}),n.label]})},n.label)}),e.jsx("li",{children:e.jsxs("button",{className:"bg-ui-bg-base hover:bg-ui-bg-base-hover focus-visible:bg-ui-bg-base-pressed text-ui-fg-base data-[disabled]:text-ui-fg-disabled txt-compact-small relative flex w-full cursor-pointer select-none items-center rounded-md px-2 py-1.5 outline-none transition-colors data-[disabled]:pointer-events-none",type:"button",onClick:m,children:[e.jsx("div",{className:O("transition-fg flex h-5 w-5 items-center justify-center",{"[&_svg]:invisible":!b}),children:e.jsx(U,{})}),W("filters.date.custom")]})})]}),b&&e.jsxs("div",{className:"border-t px-1 pb-3 pt-1",children:[e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1",children:e.jsx($,{size:"xsmall",leading:"compact",weight:"plus",children:W("filters.date.from")})}),e.jsx("div",{className:"px-2 py-1",children:e.jsx(Q,{modal:!0,maxValue:C,value:v,onChange:n=>k(n,"start")})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1",children:e.jsx($,{size:"xsmall",leading:"compact",weight:"plus",children:W("filters.date.to")})}),e.jsx("div",{className:"px-2 py-1",children:e.jsx(Q,{modal:!0,minValue:v,value:C||void 0,onChange:n=>{k(n,"end")}})})]})]})]})})]})},I=new Date;I.setHours(0,0,0,0);var be=()=>{const{t}=z();return d.useMemo(()=>[{label:t("filters.date.today"),value:{$gte:I.toISOString()}},{label:t("filters.date.lastSevenDays"),value:{$gte:new Date(I.getTime()-7*24*60*60*1e3).toISOString()}},{label:t("filters.date.lastThirtyDays"),value:{$gte:new Date(I.getTime()-30*24*60*60*1e3).toISOString()}},{label:t("filters.date.lastNinetyDays"),value:{$gte:new Date(I.getTime()-90*24*60*60*1e3).toISOString()}},{label:t("filters.date.lastTwelveMonths"),value:{$gte:new Date(I.getTime()-365*24*60*60*1e3).toISOString()}}],[t])},fe=t=>t!=null&&t.length?JSON.parse(t.join(",")):null,Z=(t,l)=>t!=null&&t[l]?new Date(t[l]):void 0,ve=({filter:t,prefix:l,readonly:s,openOnMount:x})=>{const{t:r}=z(),[h,b]=d.useState(x),{key:c,label:f}=t,{removeFilter:j}=H(),i=Y({param:c,prefix:l,multiple:!1}),g=i.get(),[N,w]=d.useState(g),[a,m]=d.useState(je(g)),y=d.useCallback(se.debounce((p,D)=>{const S=p.target.value,o=JSON.parse((g==null?void 0:g.join(","))||"{}"),n=!isNaN(Number(o)),F=E=>{if(!S&&n){i.delete();return}if(o&&!S){delete o[E],i.add(JSON.stringify(o));return}if(!o){i.add(JSON.stringify({[E]:S}));return}i.add(JSON.stringify({...o,[E]:S}))};switch(D){case"eq":S?i.add(S):i.delete();break;case"lt":case"gt":F(D);break}},500),[i,g]);d.useEffect(()=>()=>{y.cancel()},[y]);let u=null;const v=p=>{b(p),w(g),u&&clearTimeout(u),!p&&!g.length&&(u=setTimeout(()=>{j(c)},200))},C=()=>{i.delete(),j(c)},k=[{operator:"exact",label:r("filters.compare.exact")},{operator:"range",label:r("filters.compare.range")}],_=`${c}-gt`,P=`${c}-lt`,T=c,V=q(g,r),M=q(N,r);return e.jsxs(L,{modal:!0,open:h,onOpenChange:v,children:[e.jsx(G,{hasOperator:!0,hadPreviousValue:!!M,label:f,value:V,onRemove:C,readonly:s}),!s&&e.jsx(A,{children:e.jsxs(J,{"data-name":"number_filter_content",align:"start",sideOffset:8,collisionPadding:24,className:O("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout max-h-[var(--radix-popper-available-height)] w-[300px] divide-y overflow-y-auto rounded-lg outline-none"),onInteractOutside:p=>{var D;p.target instanceof HTMLElement&&((D=p.target.attributes.getNamedItem("data-name"))==null?void 0:D.value)==="filters_menu_content"&&p.preventDefault()},children:[e.jsx("div",{className:"p-1",children:e.jsx(ce,{value:a,onValueChange:p=>m(p),className:"flex flex-col items-start",orientation:"vertical",autoFocus:!0,children:k.map(p=>e.jsxs(ue,{value:p.operator,className:"txt-compact-small hover:bg-ui-bg-base-hover focus-visible:bg-ui-bg-base-hover active:bg-ui-bg-base-pressed transition-fg grid w-full grid-cols-[20px_1fr] gap-2 rounded-[4px] px-2 py-1.5 text-left outline-none",children:[e.jsx("div",{className:"size-5",children:e.jsx(de,{children:e.jsx(U,{})})}),e.jsx("span",{className:"w-full",children:p.label})]},p.operator))})}),e.jsx("div",{children:a==="range"?e.jsxs("div",{className:"px-1 pb-3 pt-1",children:[e.jsx("div",{className:"px-2 py-1.5",children:e.jsx(B,{size:"xsmall",weight:"plus",htmlFor:_,children:r("filters.compare.greaterThan")})}),e.jsx("div",{className:"px-2 py-0.5",children:e.jsx(K,{name:_,size:"small",type:"number",defaultValue:X(g,"gt"),onChange:p=>y(p,"gt")})}),e.jsx("div",{className:"px-2 py-1.5",children:e.jsx(B,{size:"xsmall",weight:"plus",htmlFor:P,children:r("filters.compare.lessThan")})}),e.jsx("div",{className:"px-2 py-0.5",children:e.jsx(K,{name:P,size:"small",type:"number",defaultValue:X(g,"lt"),onChange:p=>y(p,"lt")})})]},"range"):e.jsxs("div",{className:"px-1 pb-3 pt-1",children:[e.jsx("div",{className:"px-2 py-1.5",children:e.jsx(B,{size:"xsmall",weight:"plus",htmlFor:T,children:f})}),e.jsx("div",{className:"px-2 py-0.5",children:e.jsx(K,{name:T,size:"small",type:"number",defaultValue:X(g,"eq"),onChange:p=>y(p,"eq")})})]},"exact")})]})})]})},q=(t,l)=>{const s=JSON.parse((t==null?void 0:t.join(","))||"{}");let x="";if(typeof s=="object"){const r=[];s.gt&&r.push(l("filters.compare.greaterThanLabel",{value:s.gt})),s.lt&&r.push(l("filters.compare.lessThanLabel",{value:s.lt})),x=r.join(` ${l("filters.compare.andLabel")} `)}return typeof s=="number"&&(x=s.toString()),x},le=t=>{if(!t)return;const l=t.join(",");if(l)return JSON.parse(l)},X=(t,l)=>{const s=le(t);if(typeof s=="object")return s[l];if(typeof s=="number"&&l==="eq")return s},je=t=>typeof le(t)=="object"?"range":"exact",ye=({filter:t,prefix:l,readonly:s,multiple:x,searchable:r,options:h,openOnMount:b})=>{const[c,f]=d.useState(b),[j,i]=d.useState(""),[g,N]=d.useState(null),{t:w}=z(),{removeFilter:a}=H(),{key:m,label:y}=t,u=Y({param:m,prefix:l,multiple:x}),v=u.get(),C=v.map(o=>{var n;return(n=h.find(F=>F.value===o))==null?void 0:n.label}).filter(Boolean),[k,_]=d.useState(C),P=()=>{u.delete(),a(m)};let T=null;const V=o=>{f(o),_(C),T&&clearTimeout(T),!o&&!v.length&&(T=setTimeout(()=>{a(m)},200))},M=()=>{i(""),g&&g.focus()},p=o=>{u.get().includes(String(o))?u.delete(String(o)):u.add(String(o))},D=C?Array.isArray(C)?C:[C]:null,S=k?Array.isArray(k)?k:[k]:null;return e.jsxs(L,{modal:!0,open:c,onOpenChange:V,children:[e.jsx(G,{hasOperator:!0,hadPreviousValue:!!(S!=null&&S.length),readonly:s,label:y,value:D==null?void 0:D.join(", "),onRemove:P}),!s&&e.jsx(A,{children:e.jsx(J,{hideWhenDetached:!0,align:"start",sideOffset:8,collisionPadding:8,className:O("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout z-[1] h-full max-h-[200px] w-[300px] overflow-hidden rounded-lg outline-none"),onInteractOutside:o=>{var n;o.target instanceof HTMLElement&&((n=o.target.attributes.getNamedItem("data-name"))==null?void 0:n.value)==="filters_menu_content"&&(o.preventDefault(),o.stopPropagation())},children:e.jsxs(R,{className:"h-full",children:[r&&e.jsx("div",{className:"border-b p-1",children:e.jsxs("div",{className:"grid grid-cols-[1fr_20px] gap-x-2 rounded-md px-2 py-1",children:[e.jsx(R.Input,{ref:N,value:j,onValueChange:i,className:"txt-compact-small placeholder:text-ui-fg-muted bg-transparent outline-none",placeholder:"Search"}),e.jsx("div",{className:"flex h-5 w-5 items-center justify-center",children:e.jsx("button",{disabled:!j,onClick:M,className:O("transition-fg text-ui-fg-muted focus-visible:bg-ui-bg-base-pressed rounded-md outline-none",{invisible:!j}),children:e.jsx(ae,{})})})]})}),e.jsx(R.Empty,{className:"txt-compact-small flex items-center justify-center p-1",children:e.jsx("span",{className:"w-full px-2 py-1 text-center",children:w("general.noResultsTitle")})}),e.jsx(R.List,{className:"h-full max-h-[163px] min-h-[0] overflow-auto p-1 outline-none",children:h.map(o=>{const n=u.get().includes(String(o.value));return e.jsxs(R.Item,{className:"bg-ui-bg-base hover:bg-ui-bg-base-hover aria-selected:bg-ui-bg-base-pressed focus-visible:bg-ui-bg-base-pressed text-ui-fg-base data-[disabled]:text-ui-fg-disabled txt-compact-small relative flex cursor-pointer select-none items-center gap-x-2 rounded-md px-2 py-1.5 outline-none transition-colors data-[disabled]:pointer-events-none",value:o.label,onSelect:()=>{p(o.value)},children:[e.jsx("div",{className:O("transition-fg flex h-5 w-5 items-center justify-center",{"[&_svg]:invisible":!n}),children:x?e.jsx(me,{}):e.jsx(U,{})}),o.label]},String(o.value))})})]})})})]})},Ne=({filter:t,prefix:l,readonly:s,openOnMount:x})=>{const[r,h]=d.useState(x),{key:b,label:c}=t,{removeFilter:f}=H(),j=Y({param:b,prefix:l}),i=j.get(),[g,N]=d.useState(i==null?void 0:i[0]),w=d.useCallback(se.debounce(u=>{const v=u.target.value;v?j.add(v):j.delete()},500),[j]);d.useEffect(()=>()=>{w.cancel()},[w]);let a=null;const m=u=>{h(u),N(i==null?void 0:i[0]),a&&clearTimeout(a),!u&&!i.length&&(a=setTimeout(()=>{f(b)},200))},y=()=>{j.delete(),f(b)};return e.jsxs(L,{modal:!0,open:r,onOpenChange:m,children:[e.jsx(G,{hasOperator:!0,hadPreviousValue:!!g,label:c,value:i==null?void 0:i[0],onRemove:y,readonly:s}),!s&&e.jsx(A,{children:e.jsx(J,{hideWhenDetached:!0,align:"start",sideOffset:8,collisionPadding:8,className:O("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout z-[1] h-full max-h-[200px] w-[300px] overflow-hidden rounded-lg outline-none"),onInteractOutside:u=>{var v;u.target instanceof HTMLElement&&((v=u.target.attributes.getNamedItem("data-name"))==null?void 0:v.value)==="filters_menu_content"&&(u.preventDefault(),u.stopPropagation())},children:e.jsxs("div",{className:"px-1 pb-3 pt-1",children:[e.jsx("div",{className:"px-2 py-1.5",children:e.jsx(B,{size:"xsmall",weight:"plus",htmlFor:b,children:c})}),e.jsx("div",{className:"px-2 py-0.5",children:e.jsx(K,{name:b,size:"small",defaultValue:(i==null?void 0:i[0])||void 0,onChange:w})})]})})})]})},De=({filters:t,readonly:l,prefix:s})=>{const{t:x}=z(),[r]=ee(),[h,b]=d.useState(!1),[c,f]=d.useState(we({searchParams:r,filters:t,prefix:s})),j=t.filter(a=>!c.find(m=>m.key===a.key)),i=d.useRef(!0);d.useEffect(()=>{if(i.current){const a=new URLSearchParams(r);t.forEach(m=>{const y=s?`${s}_${m.key}`:m.key;a.get(y)&&!c.find(v=>v.key===m.key)&&(m.type==="select"?f(v=>[...v,{...m,multiple:m.multiple,options:m.options,openOnMount:!1}]):f(v=>[...v,{...m,openOnMount:!1}]))})}i.current=!1},[c,t,s,r]);const g=a=>{b(!1),f(m=>[...m,{...a,openOnMount:!0}])},N=d.useCallback(a=>{f(m=>m.filter(y=>y.key!==a))},[]),w=d.useCallback(()=>{f([])},[]);return e.jsx(ne.Provider,{value:d.useMemo(()=>({removeFilter:N,removeAllFilters:w}),[w,N]),children:e.jsxs("div",{className:"max-w-2/3 flex flex-wrap items-center gap-2",children:[c.map(a=>{switch(a.type){case"select":return e.jsx(ye,{filter:a,prefix:s,readonly:l,options:a.options,multiple:a.multiple,searchable:a.searchable,openOnMount:a.openOnMount},a.key);case"date":return e.jsx(xe,{filter:a,prefix:s,readonly:l,openOnMount:a.openOnMount},a.key);case"string":return e.jsx(Ne,{filter:a,prefix:s,readonly:l,openOnMount:a.openOnMount},a.key);case"number":return e.jsx(ve,{filter:a,prefix:s,readonly:l,openOnMount:a.openOnMount},a.key)}}),!l&&j.length>0&&e.jsxs(L,{modal:!0,open:h,onOpenChange:b,children:[e.jsx(te,{asChild:!0,id:"filters_menu_trigger",children:e.jsx(oe,{size:"small",variant:"secondary",children:x("filters.addFilter")})}),e.jsx(A,{children:e.jsx(J,{className:O("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout z-[1] h-full max-h-[200px] w-[300px] overflow-auto rounded-lg p-1 outline-none"),"data-name":"filters_menu_content",align:"start",sideOffset:8,collisionPadding:8,onCloseAutoFocus:a=>{c.find(y=>y.openOnMount)&&a.preventDefault()},children:j.map(a=>e.jsx("div",{className:"bg-ui-bg-base hover:bg-ui-bg-base-hover focus-visible:bg-ui-bg-base-pressed text-ui-fg-base data-[disabled]:text-ui-fg-disabled txt-compact-small relative flex cursor-pointer select-none items-center rounded-md px-2 py-1.5 outline-none transition-colors data-[disabled]:pointer-events-none",role:"menuitem",onClick:()=>{g(a)},children:a.label},a.key))})})]}),!l&&c.length>0&&e.jsx(Se,{filters:t,prefix:s})]})})},Se=({filters:t,prefix:l})=>{const{removeAllFilters:s}=H(),[x,r]=ee(),h=()=>{r(b=>{const c=new URLSearchParams(b);return t.forEach(f=>{c.delete(l?`${l}_${f.key}`:f.key)}),c}),s()};return e.jsx("button",{type:"button",onClick:h,className:O("text-ui-fg-muted transition-fg txt-compact-small-plus rounded-md px-2 py-1","hover:text-ui-fg-subtle","focus-visible:shadow-borders-focus"),children:"Clear all"})},we=({searchParams:t,filters:l,prefix:s})=>{const x=new URLSearchParams(t),r=[];return l.forEach(h=>{const b=s?`${s}_${h.key}`:h.key;x.get(b)&&(h.type==="select"?r.push({...h,multiple:h.multiple,options:h.options,openOnMount:!1}):r.push({...h,openOnMount:!1}))}),r};export{De as D};
