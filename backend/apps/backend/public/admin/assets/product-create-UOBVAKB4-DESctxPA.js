import{C as oe}from"./chunk-X5VECN6S-CAnU7DNP.js";import{H as Re}from"./chunk-7OYLCEKK-q2UA6oCV.js";import{u as Be,a as He,b as Ke,c as Le}from"./chunk-Z4FTQDUA-D2NSebyH.js";import{C as qe}from"./chunk-5U2UY5FJ-BGlPjZDO.js";import{u as G}from"./chunk-HFB3OQXI-Ci46Yn2d.js";import{C as U}from"./chunk-GZBFGV7Y-lbEB6NJG.js";import{n as Ge,P as Ue,a as We,U as Ze,d as ce}from"./chunk-PYOW3HT5-VilTLX4d.js";import"./chunk-ZQRKUG6J-BZ83ACZ9.js";import{D as $,c as Xe,a as Qe}from"./chunk-53RYGJCD-BwFgmB-A.js";import{C as Ye}from"./chunk-XDJ7OMBR-dJP9cgvB.js";import{r as w,b as E,i as Je,l as es,m as ss,n as ts,j as e,a as le,o as as,v as rs,w as B,s as R,t as te,B as F,F as xe,D as ns,H as ee,x as i,I as Q,y as ls,z as L,E as fe,G as Y,J as ge,K as ve,M as je,N as be,Q as ye,R as Ce,S as Ne,U as Z,V as is,W as H,X as _e,Y as os,Z as de,_ as q,$ as we,a0 as cs,a1 as ds,k as us,a2 as Se,A as Pe,a3 as Ve,a4 as ke,a5 as Ee,T as ms,a6 as ps}from"./index-DWDHrirZ.js";import{D as hs}from"./chunk-WCEBGSIU-DOrU1Qte.js";import{S as ze}from"./chunk-D7H6ZNK4-2Q1hechg.js";import{K as xs}from"./chunk-6HTZNHPT-BN1Yanla.js";import{R as O,u as De,S as A,a as fs}from"./chunk-4TC5YS65-oIm_9E30.js";import{P as T}from"./progress-tabs-DpVAqA4S.js";import{A as ae}from"./alert-DAqW66Pu.js";import{T as ue}from"./Trans-CSxUpODi.js";import{D as ie}from"./dots-six-DKZ3Y6cd.js";import{T as Ie}from"./thumbnail-badge-CFvfGejl.js";import"./chunk-2D44OO7A-BwGIGU-P.js";import"./chunk-PFKKVLZX-DzM2ADPA.js";import"./chunk-C76H5USB-NCOnWWho.js";import"./chunk-TYTNUPXB-BFzHQ2aB.js";import"./chunk-6GU6IDUA-CDc7wW5L.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./index.esm-Brl9KApB.js";var gs=Object.defineProperty,J=Object.getOwnPropertySymbols,Te=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable,me=(s,t,a)=>t in s?gs(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,vs=(s,t)=>{for(var a in t||(t={}))Te.call(t,a)&&me(s,a,t[a]);if(J)for(var a of J(t))Fe.call(t,a)&&me(s,a,t[a]);return s},js=(s,t)=>{var a={};for(var l in s)Te.call(s,l)&&t.indexOf(l)<0&&(a[l]=s[l]);if(s!=null&&J)for(var l of J(s))t.indexOf(l)<0&&Fe.call(s,l)&&(a[l]=s[l]);return a};const Me=w.forwardRef((s,t)=>{var a=s,{color:l="currentColor"}=a,n=js(a,["color"]);return w.createElement("svg",vs({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:t},n),w.createElement("path",{stroke:l,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m2.389 10.389-.748.25a.444.444 0 0 1-.585-.422V4.783c0-.303.297-.517.585-.421l.748.25M5.944 12.055l-.718.3a.445.445 0 0 1-.615-.41v-8.89c0-.317.323-.532.615-.41l.718.3M8.798 1.124l4.631 2.137c.315.145.516.46.516.807v6.862a.89.89 0 0 1-.516.807l-4.631 2.137a.445.445 0 0 1-.631-.403V1.528c0-.325.336-.54.63-.404"}))});Me.displayName="StackPerspective";var bs=({form:s})=>{const{t}=E();return e.jsxs("div",{id:"general",className:"flex flex-col gap-y-6",children:[e.jsx("div",{className:"flex flex-col gap-y-2",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx(i.Field,{control:s.control,name:"title",render:({field:a})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:t("products.fields.title.label")}),e.jsx(i.Control,{children:e.jsx(Q,{...a,placeholder:t("products.fields.title.placeholder")})})]})}),e.jsx(i.Field,{control:s.control,name:"subtitle",render:({field:a})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{optional:!0,children:t("products.fields.subtitle.label")}),e.jsx(i.Control,{children:e.jsx(Q,{...a,placeholder:t("products.fields.subtitle.placeholder")})})]})}),e.jsx(i.Field,{control:s.control,name:"handle",render:({field:a})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{tooltip:t("products.fields.handle.tooltip"),optional:!0,children:t("fields.handle")}),e.jsx(i.Control,{children:e.jsx(Re,{...a,placeholder:t("products.fields.handle.placeholder")})})]})})]})}),e.jsx(i.Field,{control:s.control,name:"description",render:({field:a})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{optional:!0,children:t("products.fields.description.label")}),e.jsx(i.Control,{children:e.jsx(ls,{...a,placeholder:t("products.fields.description.placeholder")})})]})})]})},ys={sideEffects:Ce({styles:{active:{opacity:"0.4"}}})},Cs=({form:s})=>{const{fields:t,append:a,remove:l}=L({name:"media",control:s.control,keyName:"field_id"}),[n,r]=w.useState(null),u=fe(Y(je),Y(ve,{coordinateGetter:ge})),p=v=>{r(v.active.id)},m=v=>{r(null);const{active:P,over:N}=v;if(P.id!==(N==null?void 0:N.id)){const V=t.findIndex(g=>g.field_id===P.id),z=t.findIndex(g=>g.field_id===(N==null?void 0:N.id));s.setValue("media",Se(t,V,z),{shouldDirty:!0,shouldTouch:!0})}},h=()=>{r(null)},c=v=>()=>{l(v)},d=v=>()=>{const P=t.map((N,V)=>({...N,isThumbnail:V===v}));s.setValue("media",P,{shouldDirty:!0,shouldTouch:!0})},f=v=>({onDelete:c(v),onMakeThumbnail:d(v)});return e.jsxs("div",{id:"media",className:"flex flex-col gap-y-2",children:[e.jsx(Ze,{form:s,append:a,showHint:!1}),e.jsxs(be,{sensors:u,onDragEnd:m,onDragStart:p,onDragCancel:h,children:[e.jsx(ye,{dropAnimation:ys,children:n?e.jsx(_s,{field:t.find(v=>v.field_id===n)}):null}),e.jsx("ul",{className:"flex flex-col gap-y-2",children:e.jsx(Ne,{items:t.map(v=>v.field_id),children:t.map((v,P)=>{const{onDelete:N,onMakeThumbnail:V}=f(P);return e.jsx(Ns,{field:v,onDelete:N,onMakeThumbnail:V},v.field_id)})})})]})]})},Ns=({field:s,onDelete:t,onMakeThumbnail:a})=>{const{t:l}=E(),{attributes:n,listeners:r,setNodeRef:u,setActivatorNodeRef:p,transform:m,transition:h,isDragging:c}=ke({id:s.field_id}),d={opacity:c?.4:void 0,transform:Ee.Translate.toString(m),transition:h};return s.file?e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest flex items-center justify-between rounded-lg px-3 py-2",ref:u,style:d,children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(H,{variant:"transparent",type:"button",size:"small",...n,...r,ref:p,className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(ie,{className:"text-ui-fg-muted"})}),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base h-10 w-[30px] overflow-hidden rounded-md",children:e.jsx(Oe,{url:s.url})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(q,{size:"small",leading:"compact",children:s.file.name}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[s.isThumbnail&&e.jsx(Ie,{}),e.jsx(q,{size:"xsmall",leading:"compact",className:"text-ui-fg-subtle",children:$e(s.file.size)})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(Pe,{groups:[{actions:[{label:l("products.media.makeThumbnail"),icon:e.jsx(Me,{}),onClick:a}]},{actions:[{icon:e.jsx(ms,{}),label:l("actions.delete"),onClick:t}]}]}),e.jsx(H,{type:"button",size:"small",variant:"transparent",onClick:t,children:e.jsx(Ve,{})})]})]}):null},_s=({field:s})=>{var t,a;return e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest flex items-center justify-between rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(H,{variant:"transparent",size:"small",className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(ie,{className:"text-ui-fg-muted"})}),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base h-10 w-[30px] overflow-hidden rounded-md",children:e.jsx(Oe,{url:s.url})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(q,{size:"small",leading:"compact",children:(t=s.file)==null?void 0:t.name}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[s.isThumbnail&&e.jsx(Ie,{}),e.jsx(q,{size:"xsmall",leading:"compact",className:"text-ui-fg-subtle",children:$e(((a=s.file)==null?void 0:a.size)??0)})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(Pe,{groups:[]}),e.jsx(H,{type:"button",size:"small",variant:"transparent",onClick:()=>{},children:e.jsx(Ve,{})})]})]})},Oe=({url:s})=>s?e.jsx("img",{src:s,alt:"",className:"size-full object-cover object-center"}):null;function $e(s,t=2){if(s===0)return"0 Bytes";const a=1024,l=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(s)/Math.log(a));return parseFloat((s/Math.pow(a,n)).toFixed(t))+" "+l[n]}var ws=({items:s,onChange:t,renderItem:a})=>{const[l,n]=w.useState(null),[r,u]=w.useMemo(()=>{if(l===null)return[null,null];const d=s.findIndex(({id:f})=>f===l.id);return[s[d],d]},[l,s]),p=fe(Y(je),Y(ve,{coordinateGetter:ge})),m=({active:d})=>{n(d)},h=({active:d,over:f})=>{if(f&&d.id!==f.id){const v=s.findIndex(({id:N})=>N===d.id),P=s.findIndex(({id:N})=>N===f.id);t(Se(s,v,P))}n(null)},c=()=>{n(null)};return e.jsxs(be,{sensors:p,onDragStart:m,onDragEnd:h,onDragCancel:c,children:[e.jsx(Ps,{children:r&&u!==null?a(r,u):null}),e.jsx(Ne,{items:s,children:e.jsx("ul",{role:"application",className:"flex list-inside list-none list-image-none flex-col p-0",children:s.map((d,f)=>e.jsx(w.Fragment,{children:a(d,f)},d.id))})})]})},Ss={sideEffects:Ce({styles:{active:{opacity:"0.4"}}})},Ps=({children:s})=>e.jsx(ye,{className:"shadow-elevation-card-hover overflow-hidden rounded-md [&>li]:border-b-0",dropAnimation:Ss,children:s}),Ae=w.createContext(null),Vs=()=>{const s=w.useContext(Ae);if(!s)throw new Error("useSortableItemContext must be used within a SortableItemContext");return s},ks=({id:s,className:t,children:a})=>{const{attributes:l,isDragging:n,listeners:r,setNodeRef:u,setActivatorNodeRef:p,transform:m,transition:h}=ke({id:s}),c=w.useMemo(()=>({attributes:l,listeners:r,ref:p,isDragging:n}),[l,r,p,n]),d={opacity:n?.4:void 0,transform:Ee.Translate.toString(m),transition:h};return e.jsx(Ae.Provider,{value:c,children:e.jsx("li",{className:we("transition-fg flex flex-1 list-none",t),ref:u,style:d,children:a})})},Es=()=>{const{attributes:s,listeners:t,ref:a}=Vs();return e.jsx(H,{variant:"transparent",size:"small",...s,...t,ref:a,className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(ie,{className:"text-ui-fg-muted"})})},re=Object.assign(ws,{Item:ks,DragHandle:Es}),ne=s=>{if(s.length===0)return[];if(s.length===1)return s[0].values.map(l=>({[s[0].title]:l}));const t=s[0],a=s.slice(1);return t.values.flatMap(l=>ne(a).map(n=>({[t.title]:l,...n})))},X=s=>Object.values(s).join(" / "),zs=({form:s})=>{var N,V,z;const{t}=E(),a=L({control:s.control,name:"options"}),l=L({control:s.control,name:"variants"}),n=B({control:s.control,name:"enable_variants",defaultValue:!1}),r=B({control:s.control,name:"options",defaultValue:[]}),u=B({control:s.control,name:"variants",defaultValue:[]}),p=!!((N=s.formState.errors.options)!=null&&N.length),m=((z=(V=s.formState.errors.variants)==null?void 0:V.root)==null?void 0:z.message)==="invalid_length",h=(g,x)=>{const{isTouched:o}=s.getFieldState("variants"),j=[...r];j[g].values=x;const y=ne(j),_=[...u],I=b=>y.find(M=>Object.keys(b).every(k=>b[k]===M[k])),D=_.reduce((b,M)=>{const k=I(M.options);return k&&b.push({...M,title:X(k),options:k}),b},[]),C=new Set(D.map(b=>b.options));y.filter(b=>!C.has(b)).forEach(b=>{D.push({title:X(b),options:b,should_create:!o,variant_rank:D.length,inventory:[{inventory_item_id:"",required_quantity:""}]})}),s.setValue("variants",D)},c=g=>{if(g===0)return;a.remove(g);const x=[...r];x.splice(g,1);const o=ne(x),j=[...u],y=C=>o.find(S=>Object.keys(C).every(b=>C[b]===S[b])),_=j.reduce((C,S)=>{const b=y(S.options);return b&&C.push({...S,title:X(b),options:b}),C},[]),I=new Set(_.map(C=>C.options));o.filter(C=>!I.has(C)).forEach(C=>{_.push({title:X(C),options:C,should_create:!1,variant_rank:_.length})}),s.setValue("variants",_)},d=g=>{const x=g.map((o,j)=>{const y=u.find(_=>_.title===o.title);return{id:o.id,...y||o,variant_rank:j}});l.replace(x)},f=g=>g.every(x=>x.should_create)?!0:g.some(x=>x.should_create)?"indeterminate":!1,v=g=>{switch(g){case!0:{const x=u.map(o=>({...o,should_create:!0}));s.setValue("variants",x);break}case!1:{const x=u.map(o=>({...o,should_create:!1}));s.setValue("variants",ce(x));break}}},P=()=>{s.setValue("options",[{title:"Default option",values:["Default option value"]}]),s.setValue("variants",ce([{title:"Default variant",should_create:!0,variant_rank:0,options:{"Default option":"Default option value"},inventory:[{inventory_item_id:"",required_quantity:""}],is_default:!0}]))};return e.jsxs("div",{id:"variants",className:"flex flex-col gap-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsx(ee,{level:"h2",children:t("products.create.variants.header")}),e.jsx(ze,{control:s.control,name:"enable_variants",label:t("products.create.variants.subHeadingTitle"),description:t("products.create.variants.subHeadingDescription"),onCheckedChange:g=>{g?(s.setValue("options",[{title:"",values:[]}]),s.setValue("variants",[])):P()}})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-y-6",children:e.jsx(i.Field,{control:s.control,name:"options",render:()=>e.jsx(i.Item,{children:e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(i.Label,{children:t("products.create.variants.productOptions.label")}),e.jsx(i.Hint,{children:t("products.create.variants.productOptions.hint")})]}),e.jsx(F,{size:"small",variant:"secondary",type:"button",onClick:()=>{a.append({title:"",values:[]})},children:t("actions.add")})]}),p&&e.jsx(ae,{dismissible:!0,variant:"error",children:t("products.create.errors.options")}),e.jsx("ul",{className:"flex flex-col gap-y-4",children:a.fields.map((g,x)=>e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(Z,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`options.${x}.title`,children:t("fields.title")})}),e.jsx(Q,{className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",...s.register(`options.${x}.title`),placeholder:t("products.fields.options.optionTitlePlaceholder")}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(Z,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`options.${x}.values`,children:t("fields.values")})}),e.jsx(is,{control:s.control,name:`options.${x}.values`,render:({field:{onChange:o,...j}})=>{const y=_=>{h(x,_),o(_)};return e.jsx(Ye,{...j,variant:"contrast",onChange:y,placeholder:t("products.fields.options.variantionsPlaceholder")})}})]}),e.jsx(H,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",disabled:x===0,onClick:()=>c(x),children:e.jsx(_e,{})})]},g.id))})]})})})}),e.jsx("div",{className:"grid grid-cols-1 gap-x-4 gap-y-8",children:e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Z,{weight:"plus",children:t("products.create.variants.productVariants.label")}),e.jsx(os,{children:t("products.create.variants.productVariants.hint")})]}),!p&&m&&e.jsx(ae,{dismissible:!0,variant:"error",children:t("products.create.errors.variants")}),l.fields.length>0?e.jsxs("div",{className:"overflow-hidden rounded-xl border",children:[e.jsxs("div",{className:"bg-ui-bg-component text-ui-fg-subtle grid items-center gap-3 border-b px-6 py-2.5",style:{gridTemplateColumns:`20px 28px repeat(${r.length}, 1fr)`},children:[e.jsx("div",{children:e.jsx(de,{className:"relative",checked:f(u),onCheckedChange:v})}),e.jsx("div",{}),r.map((g,x)=>e.jsx("div",{children:e.jsx(q,{size:"small",leading:"compact",weight:"plus",children:g.title})},x))]}),e.jsx(re,{items:l.fields,onChange:d,renderItem:(g,x)=>e.jsx(re.Item,{id:g.id,className:we("bg-ui-bg-base border-b",{"border-b-0":x===l.fields.length-1}),children:e.jsxs("div",{className:"text-ui-fg-subtle grid w-full items-center gap-3 px-6 py-2.5",style:{gridTemplateColumns:`20px 28px repeat(${r.length}, 1fr)`},children:[e.jsx(i.Field,{control:s.control,name:`variants.${x}.should_create`,render:({field:{value:o,onChange:j,...y}})=>e.jsx(i.Item,{children:e.jsx(i.Control,{children:e.jsx(de,{className:"relative",...y,checked:o,onCheckedChange:j})})})}),e.jsx(re.DragHandle,{}),Object.values(g.options).map((o,j)=>e.jsx(q,{size:"small",leading:"compact",children:o},j))]})})})]}):e.jsx(ae,{children:t("products.create.variants.productVariants.alert")}),l.fields.length>0&&e.jsx(cs,{label:t("general.tip"),children:t("products.create.variants.productVariants.tip")})]})})]})]})},Ds=({form:s})=>{const{getFormFields:t}=le(),a=t("product","create","general");return e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx(Is,{}),e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsx(bs,{form:s}),e.jsx(xe,{fields:a,form:s}),e.jsx(Cs,{form:s})]}),e.jsx(ns,{}),e.jsx(zs,{form:s})]})})},Is=()=>{const{t:s}=E();return e.jsx("div",{className:"flex flex-col",children:e.jsx(ee,{children:s("products.create.header")})})};function Ts({form:s,variantIndex:t,inventoryIndex:a,inventoryItem:l,isItemOptionDisabled:n,onRemove:r}){const{t:u}=E(),p=G({queryKey:["inventory_items"],defaultValueKey:"id",defaultValue:l.inventory_item_id,queryFn:m=>R.admin.inventoryItem.list(m),getOptions:m=>m.inventory_items.map(h=>({label:`${h.title} ${h.sku?`(${h.sku})`:""}`,value:h.id}))});return e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(Z,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`variants.${t}.inventory.${a}.inventory_item_id`,children:u("fields.item")})}),e.jsx(i.Field,{control:s.control,name:`variants.${t}.inventory.${a}.inventory_item_id`,render:({field:m})=>e.jsx(i.Item,{children:e.jsx(i.Control,{children:e.jsx(U,{...m,options:p.options.map(h=>({...h,disabled:n(h,a)})),searchValue:p.searchValue,onBlur:()=>p.onSearchValueChange(""),onSearchValueChange:p.onSearchValueChange,fetchNextPage:p.fetchNextPage,className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",placeholder:u("products.create.inventory.itemPlaceholder")})})})}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(Z,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`variants.${t}.inventory.${a}.required_quantity`,children:u("fields.quantity")})}),e.jsx(i.Field,{control:s.control,name:`variants.${t}.inventory.${a}.required_quantity`,render:({field:{onChange:m,value:h,...c}})=>e.jsxs(i.Item,{children:[e.jsx(i.Control,{children:e.jsx(Q,{type:"number",className:"bg-ui-bg-field-component",min:0,value:h,onChange:d=>{const f=d.target.value;m(f===""?null:Number(f))},...c,placeholder:u("products.create.inventory.quantityPlaceholder")})}),e.jsx(i.ErrorMessage,{})]})})]}),e.jsx(H,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",onClick:r,children:e.jsx(_e,{})})]},l.id)}function Fs({form:s,variant:t,index:a}){const{t:l}=E(),n=L({control:s.control,name:`variants.${a}.inventory`}),r=B({control:s.control,name:`variants.${a}.inventory`}),u=(p,m)=>!!(r!=null&&r.some((h,c)=>c!=m&&h.inventory_item_id===p.value));return e.jsxs("div",{className:"grid gap-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(i.Label,{children:t.title}),e.jsx(i.Hint,{children:l("products.create.inventory.label")})]}),e.jsx(F,{size:"small",variant:"secondary",type:"button",onClick:()=>{n.append({inventory_item_id:"",required_quantity:""})},children:l("actions.add")})]}),n.fields.map((p,m)=>e.jsx(Ts,{form:s,variantIndex:a,inventoryIndex:m,inventoryItem:p,isItemOptionDisabled:u,onRemove:()=>n.remove(m)},p.id))]})}var Ms=({form:s})=>{const{t}=E(),a=L({control:s.control,name:"variants"});return e.jsxs("div",{id:"organize",className:"flex flex-col gap-y-8",children:[e.jsx(ee,{children:t("products.create.inventory.heading")}),a.fields.filter(l=>l.inventory_kit).map((l,n)=>e.jsx(Fs,{form:s,variant:l,index:n},l.id))]})},Os=({form:s})=>e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsx("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:e.jsx(Ms,{form:s})})}),$s=({form:s})=>{const{t}=E(),a=G({queryKey:["product_collections"],queryFn:c=>R.admin.productCollection.list(c),getOptions:c=>c.collections.map(d=>({label:d.title,value:d.id}))}),l=G({queryKey:["product_types"],queryFn:c=>R.admin.productType.list(c),getOptions:c=>c.product_types.map(d=>({label:d.value,value:d.id}))}),n=G({queryKey:["product_tags"],queryFn:c=>R.admin.productTag.list(c),getOptions:c=>c.product_tags.map(d=>({label:d.value,value:d.id}))}),r=G({queryKey:["shipping_profiles"],queryFn:c=>R.admin.shippingProfile.list(c),getOptions:c=>c.shipping_profiles.map(d=>({label:d.name,value:d.id}))}),{fields:u,remove:p,replace:m}=L({control:s.control,name:"sales_channels",keyName:"key"}),h=()=>{m([])};return e.jsxs("div",{id:"organize",className:"flex flex-col gap-y-8",children:[e.jsx(ee,{children:t("products.organization.header")}),e.jsx(ze,{control:s.control,name:"discountable",label:t("products.fields.discountable.label"),description:t("products.fields.discountable.hint"),optional:!0}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(i.Field,{control:s.control,name:"type_id",render:({field:c})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{optional:!0,children:t("products.fields.type.label")}),e.jsx(i.Control,{children:e.jsx(U,{...c,options:l.options,searchValue:l.searchValue,onSearchValueChange:l.onSearchValueChange,fetchNextPage:l.fetchNextPage})}),e.jsx(i.ErrorMessage,{})]})}),e.jsx(i.Field,{control:s.control,name:"collection_id",render:({field:c})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{optional:!0,children:t("products.fields.collection.label")}),e.jsx(i.Control,{children:e.jsx(U,{...c,options:a.options,searchValue:a.searchValue,onSearchValueChange:a.onSearchValueChange,fetchNextPage:a.fetchNextPage})}),e.jsx(i.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(i.Field,{control:s.control,name:"categories",render:({field:c})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{optional:!0,children:t("products.fields.categories.label")}),e.jsx(i.Control,{children:e.jsx(qe,{...c})}),e.jsx(i.ErrorMessage,{})]})}),e.jsx(i.Field,{control:s.control,name:"tags",render:({field:c})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{optional:!0,children:t("products.fields.tags.label")}),e.jsx(i.Control,{children:e.jsx(U,{...c,options:n.options,searchValue:n.searchValue,onSearchValueChange:n.onSearchValueChange,fetchNextPage:n.fetchNextPage})}),e.jsx(i.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(i.Label,{optional:!0,children:t("products.fields.shipping_profile.label")}),e.jsx(i.Hint,{children:e.jsx(ue,{i18nKey:"products.fields.shipping_profile.hint"})})]}),e.jsx(i.Field,{control:s.control,name:"shipping_profile_id",render:({field:c})=>e.jsxs(i.Item,{children:[e.jsx(i.Control,{children:e.jsx(U,{...c,options:r.options,searchValue:r.searchValue,onSearchValueChange:r.onSearchValueChange,fetchNextPage:r.fetchNextPage})}),e.jsx(i.ErrorMessage,{})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-y-4",children:e.jsx(i.Field,{control:s.control,name:"sales_channels",render:()=>e.jsxs(i.Item,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{children:[e.jsx(i.Label,{optional:!0,children:t("products.fields.sales_channels.label")}),e.jsx(i.Hint,{children:e.jsx(ue,{i18nKey:"products.fields.sales_channels.hint"})})]}),e.jsx(A.Trigger,{asChild:!0,children:e.jsx(F,{size:"small",variant:"secondary",type:"button",children:t("actions.add")})})]}),e.jsx(i.Control,{className:"mt-0",children:u.length>0&&e.jsx(oe,{onClearAll:h,onRemove:p,className:"py-4",children:u.map((c,d)=>e.jsx(oe.Chip,{index:d,children:c.name},c.key))})})]})})})]})},W="sc",pe=20,As=({form:s})=>{const{t}=E(),{getValues:a,setValue:l}=s,{setIsOpen:n,getIsOpen:r}=fs(),[u,p]=w.useState({}),[m,h]=w.useState([]),c=Be({pageSize:pe,prefix:W}),{sales_channels:d,count:f,isLoading:v,isError:P,error:N}=ds(c,{placeholderData:us}),V=r(W);w.useEffect(()=>{if(!V)return;const y=a("sales_channels");y&&(h(y.map(_=>({id:_.id,name:_.name}))),p(y.reduce((_,I)=>({..._,[I.id]:!0}),{})))},[V,a]);const z=y=>{const _=Object.keys(y),I=new Set(_.filter(C=>y[C]&&!u[C]));let D=[];I.size>0&&(D=(d==null?void 0:d.filter(C=>I.has(C.id)))??[]),h(C=>{const S=C.filter(b=>y[b.id]);return Array.from(new Set([...S,...D]))}),p(y)},g=()=>{l("sales_channels",m,{shouldDirty:!0,shouldTouch:!0}),n(W,!1)},x=He(),o=Bs(),j=Ke();if(P)throw N;return e.jsxs(A.Content,{className:"flex flex-col overflow-hidden",children:[e.jsx(A.Header,{}),e.jsx(A.Body,{className:"flex-1 overflow-hidden",children:e.jsx(hs,{data:d,columns:o,filters:x,emptyState:j,rowCount:f,pageSize:pe,getRowId:y=>y.id,rowSelection:{state:u,onRowSelectionChange:z},isLoading:v,layout:"fill",prefix:W})}),e.jsx(A.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(A.Close,{asChild:!0,children:e.jsx(F,{size:"small",variant:"secondary",type:"button",children:t("actions.cancel")})}),e.jsx(F,{size:"small",onClick:g,type:"button",children:t("actions.save")})]})})]})},Rs=ps(),Bs=()=>{const s=Le();return w.useMemo(()=>[Rs.select(),...s],[s])},Hs=({form:s})=>{const{getFormFields:t}=le(),a=t("product","create","organize");return e.jsxs(A,{id:W,children:[e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx($s,{form:s}),e.jsx(xe,{fields:a,form:s})]})}),e.jsx(As,{form:s})]})},Ks=({form:s,regions:t,store:a,pricePreferences:l})=>{const{setCloseOnEscape:n}=De(),r=w.useMemo(()=>{var c;return((c=a==null?void 0:a.supported_currencies)==null?void 0:c.map(d=>d.currency_code))||[]},[a]),u=B({control:s.control,name:"variants",defaultValue:[]}),p=B({control:s.control,name:"options",defaultValue:[]}),m=Ls({options:p,currencies:r,regions:t,pricePreferences:l}),h=w.useMemo(()=>{const c=[];return u.forEach((d,f)=>{d.should_create&&c.push({...d,originalIndex:f})}),c},[u]);return e.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:e.jsx($,{columns:m,data:h,state:s,onEditingChange:c=>n(!c)})})},K=Xe(),Ls=({options:s,currencies:t=[],regions:a=[],pricePreferences:l=[]})=>{const{t:n}=E();return w.useMemo(()=>[K.column({id:"options",header:()=>e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:s.map(r=>r.title).join(" / ")})}),cell:r=>e.jsx($.ReadonlyCell,{context:r,children:s.map(u=>r.row.original.options[u.title]).join(" / ")}),disableHiding:!0}),K.column({id:"title",name:n("fields.title"),header:n("fields.title"),field:r=>`variants.${r.row.original.originalIndex}.title`,type:"text",cell:r=>e.jsx($.TextCell,{context:r})}),K.column({id:"sku",name:n("fields.sku"),header:n("fields.sku"),field:r=>`variants.${r.row.original.originalIndex}.sku`,type:"text",cell:r=>e.jsx($.TextCell,{context:r})}),K.column({id:"manage_inventory",name:n("fields.managedInventory"),header:n("fields.managedInventory"),field:r=>`variants.${r.row.original.originalIndex}.manage_inventory`,type:"boolean",cell:r=>e.jsx($.BooleanCell,{context:r})}),K.column({id:"allow_backorder",name:n("fields.allowBackorder"),header:n("fields.allowBackorder"),field:r=>`variants.${r.row.original.originalIndex}.allow_backorder`,type:"boolean",cell:r=>e.jsx($.BooleanCell,{context:r})}),K.column({id:"inventory_kit",name:n("fields.inventoryKit"),header:n("fields.inventoryKit"),field:r=>`variants.${r.row.original.originalIndex}.inventory_kit`,type:"boolean",cell:r=>e.jsx($.BooleanCell,{context:r,disabled:!r.row.original.manage_inventory})}),...Qe({currencies:t,regions:a,pricePreferences:l,getFieldName:(r,u)=>{var p;return(p=r.column.id)!=null&&p.startsWith("currency_prices")?`variants.${r.row.original.originalIndex}.prices.${u}`:`variants.${r.row.original.originalIndex}.prices.${u}`},t:n})],[t,a,s,l,n])},he="save-draft-button",qs=({defaultChannel:s,regions:t,store:a,pricePreferences:l})=>{const[n,r]=w.useState("details"),[u,p]=w.useState({details:"in-progress",organize:"not-started",variants:"not-started",inventory:"not-started"}),{t:m}=E(),{handleSuccess:h}=De(),{getFormConfigs:c}=le(),d=c("product","create"),f=as({defaultValues:{...We,sales_channels:s?[{id:s.id,name:s.name}]:[]},schema:Ue,configs:d}),{mutateAsync:v,isPending:P}=rs(),N=w.useMemo(()=>t!=null&&t.length?t.reduce((o,j)=>(o[j.id]=j.currency_code,o),{}):{},[t]),V=B({control:f.control,name:"variants"}),z=w.useMemo(()=>V.some(o=>o.manage_inventory&&o.inventory_kit),[V]),g=f.handleSubmit(async(o,j)=>{var C;let y=!1;(j==null?void 0:j.nativeEvent)instanceof SubmitEvent&&(y=((C=j==null?void 0:j.nativeEvent)==null?void 0:C.submitter).dataset.name===he);const _=o.media||[],I={...o,media:void 0};let D=[];try{if(_.length){const S=_.find(k=>k.isThumbnail),b=_.filter(k=>!k.isThumbnail),M=[];S&&M.push(R.admin.upload.create({files:[S.file]}).then(k=>k.files.map(se=>({...se,isThumbnail:!0})))),b!=null&&b.length&&M.push(R.admin.upload.create({files:b.map(k=>k.file)}).then(k=>k.files.map(se=>({...se,isThumbnail:!1})))),D=(await Promise.all(M)).flat()}}catch(S){S instanceof Error&&te.error(S.message)}await v(Ge({...I,media:D,status:y?"draft":"published",regionsCurrencyMap:N}),{onSuccess:S=>{te.success(m("products.create.successToast",{title:S.product.title})),h(`../${S.product.id}`)},onError:S=>{te.error(S.message)}})}),x=async o=>{await f.trigger()&&(o==="details"&&r("organize"),o==="organize"&&r("variants"),o==="variants"&&r("inventory"))};return w.useEffect(()=>{const o={...u};n==="details"&&(o.details="in-progress"),n==="organize"&&(o.details="completed",o.organize="in-progress"),n==="variants"&&(o.details="completed",o.organize="completed",o.variants="in-progress"),n==="inventory"&&(o.details="completed",o.organize="completed",o.variants="completed",o.inventory="in-progress"),p({...o})},[n]),e.jsx(O.Form,{form:f,children:e.jsxs(xs,{onKeyDown:o=>{if(o.key==="Enter"){if(o.target instanceof HTMLTextAreaElement&&!(o.metaKey||o.ctrlKey))return;if(o.preventDefault(),o.metaKey||o.ctrlKey){if(n!=="variants"){o.preventDefault(),o.stopPropagation(),x(n);return}g()}}},onSubmit:g,className:"flex h-full flex-col",children:[e.jsxs(T,{value:n,onValueChange:async o=>{await f.trigger()&&r(o)},className:"flex h-full flex-col overflow-hidden",children:[e.jsx(O.Header,{children:e.jsx("div",{className:"-my-2 w-full border-l",children:e.jsxs(T.List,{className:"justify-start-start flex w-full items-center",children:[e.jsx(T.Trigger,{status:u.details,value:"details",className:"max-w-[200px] truncate",children:m("products.create.tabs.details")}),e.jsx(T.Trigger,{status:u.organize,value:"organize",className:"max-w-[200px] truncate",children:m("products.create.tabs.organize")}),e.jsx(T.Trigger,{status:u.variants,value:"variants",className:"max-w-[200px] truncate",children:m("products.create.tabs.variants")}),z&&e.jsx(T.Trigger,{status:u.inventory,value:"inventory",className:"max-w-[200px] truncate",children:m("products.create.tabs.inventory")})]})})}),e.jsxs(O.Body,{className:"size-full overflow-hidden",children:[e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"details",children:e.jsx(Ds,{form:f})}),e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"organize",children:e.jsx(Hs,{form:f})}),e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"variants",children:e.jsx(Ks,{form:f,store:a,regions:t,pricePreferences:l})}),z&&e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"inventory",children:e.jsx(Os,{form:f})})]})]}),e.jsx(O.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(O.Close,{asChild:!0,children:e.jsx(F,{variant:"secondary",size:"small",children:m("actions.cancel")})}),e.jsx(F,{"data-name":he,size:"small",type:"submit",isLoading:P,className:"whitespace-nowrap",children:m("actions.saveAsDraft")}),e.jsx(Gs,{tab:n,next:x,isLoading:P,showInventoryTab:z})]})})]})})},Gs=({tab:s,next:t,isLoading:a,showInventoryTab:l})=>{const{t:n}=E();return s==="variants"&&!l||s==="inventory"&&l?e.jsx(F,{"data-name":"publish-button",type:"submit",variant:"primary",size:"small",isLoading:a,children:n("actions.publish")},"submit-button"):e.jsx(F,{type:"button",variant:"primary",size:"small",onClick:()=>t(s),children:n("actions.continue")},"next-button")},bt=()=>{const{t:s}=E(),{store:t,isPending:a,isError:l,error:n}=Je({fields:"+default_sales_channel"}),{sales_channel:r,isPending:u,isError:p,error:m}=es(t==null?void 0:t.default_sales_channel_id,{enabled:!!(t!=null&&t.default_sales_channel_id)}),{regions:h,isPending:c,isError:d,error:f}=ss({limit:9999}),{price_preferences:v,isPending:P,isError:N,error:V}=ts({limit:9999}),z=!!t&&!a&&!!h&&!c&&!!r&&!u&&!!v&&!P;if(l)throw n;if(d)throw f;if(p)throw m;if(N)throw V;return e.jsxs(O,{children:[e.jsx(O.Title,{asChild:!0,children:e.jsx("span",{className:"sr-only",children:s("products.create.title")})}),e.jsx(O.Description,{asChild:!0,children:e.jsx("span",{className:"sr-only",children:s("products.create.description")})}),z&&e.jsx(qs,{defaultChannel:r,store:t,pricePreferences:v,regions:h})]})};export{bt as Component};
